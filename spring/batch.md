# Spring/Batch

# Spring Batch

> 배치(Batch)는 일괄처리 라는 뜻을 가지고 있다.

##### 배치 어플리케이션이 필요한 경우

- 매일 전날 데이터 집계를 해야 할 때
- 매일 집계하는 데이터가 너무 많아서 처리중 실패했을 때 실패 지점부터 다시 실행이 필요할 때
- 집계 데이터가 중복되지 않기를 바랄 때 (같은 파라미터로 같은 함수를 다시 실행하는 경우 실패하도록)

위와 같은 단발성 대용량 데이터 처리 어플리케이션을 배치 어플리케이션이라고 한다. 배치 어플리케이션을 구성하기 위해서는 비즈니스 로직 외에 부가적으로 신경써야할 부분들이 많다.
Spring Batch는 배치 어플리케이션을 보다 쉽고 안정적으로 구성할 수 있도록 제공한다.


##### 배치 어플리케이션

배치 어플리케이션은 다음 조건들을 만족해야 한다.

- 대용량 데이터 : 대량의 데이터를 전달, 계산, 가져오는 등의 처리를 할 수 있어야 한다
- 자동화 : 심각한 문제 해결을 제외하고 사용자 개입없이 실행되어야 한다
- 안정성 : 잘못된 데이터 충돌/중단 없이 처리할 수 있어야 한다
- 신뢰성 : 무엇이 잘못되었는지 추적 가능해야 한다 (로깅, 알림)
- 성능 : 지정한 시간안에 처리를 완료하거나 동시에 실행되는 다른 어플리케이션을 방해하지 않도록 수행되어야한다



---
### Spring Batch

##### Batch / Quartz

Spring Quartz 는 스케줄러 역할으로, Batch와 같은 대용량 데이터 배치 처리에 대한 기능을 지원하지 않는다. Batch 역시 Quartz의 다양한 스케줄 기능을 지원하지 않아서 보통 둘을 조합해서 사용한다. (정해진 스케줄마다 Quartz가 Spring Batch를 실행)


##### Batch 사례

- 일매출 집계

많은 거래가 이루어지는 커머스는 하루 거래가 50 ~ 100만 까지 발생한다. 이 경우 하루 데이터는 최소 100만 ~ 200만 row, 한달에 5000만 ~ 1억 정도가 될 수 있다.

실시간 집계 쿼리로 해결하면 조회 시간이나 서버 부하가 심하다. 그래서 매일 새벽에 전날 매출 집계 데이터를 만들어 외부 요청이 올 경우 미리 만들어준 집계 데이터를 바로 전달하면 성능과 부하 문제를 해결할 수 있다.

![spring Batch 일매출 집계](https://t1.daumcdn.net/cfile/tistory/9995544C5B606DFE0F)


- ERP 연동

대부분의 서비스에서 ERP를 사용한다.

> ERP는 자원 관리 시스템으로 사내 구성원, 매출, 지출 등을 모두 관리하는 소프트웨어 시스템을 뜻한다 (SAP)

재무팀의 요구사항으로 매일 매출 현황을 ERP로 전달해야하는 상황에서 Spring Batch가 많이 사용된다. 매일 아침 8시에 ERP에 전달해야할 매출 데이터를 전송해야한다면 아래와 같은 구조로 쉽게 구현할 수 있다.

![Spring Batch ERP](https://t1.daumcdn.net/cfile/tistory/991BB2365B606DFE1B)

> 이외에도 정해진 시간마다 데이터 가공이 필요한 경우 Spring Batch가 자주 사용된다


##### Spring Batch 프로젝트 생성





---
[jojoldu | Spring Batch 가이드](https://jojoldu.tistory.com/324)
